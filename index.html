<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WORK WITH</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }

      @keyframes fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      @keyframes slide-up {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
      @keyframes slide-in-left {
        from { transform: translateX(-20px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slide-in-up {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
      @keyframes bounce-in {
        0% { transform: scale(0.3); opacity: 0; }
        50% { transform: scale(1.05); }
        70% { transform: scale(0.9); }
        100% { transform: scale(1); opacity: 1; }
      }
      @keyframes slide-in {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes fade-out {
        from { opacity: 1; }
        to { opacity: 0; }
      }
      .animate-fade-in { animation: fade-in 0.6s ease-out; }
      .animate-slide-up { animation: slide-up 0.6s ease-out; }
      .animate-slide-in-left { animation: slide-in-left 0.6s ease-out; }
      .animate-slide-in-up { animation: slide-in-up 0.6s ease-out; }
      .animate-bounce-in { animation: bounce-in 0.6s ease-out; }
    </style>
    
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for in-browser JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
</head>
<body class="bg-gray-50 text-gray-900">
    <div id="root"></div>

    <script type="text/babel">
      // All application code is bundled here.
      // Babel will transpile this JSX code in the browser.

      // --- From types.ts ---
      const AspectStatus = {
        UNSELECTED: 0,
        NEED_IMPROVEMENT: 1,
        NO_NEED: 2,
      };

      // --- From services/summaryGenerator.ts ---
      function generateSummary(ratings) {
        const [speed, stability, support, price, overall] = ratings;
        if (ratings.every(r => r === 0)) {
          return "Please provide ratings to generate a summary.";
        }

        let text = [];
        const avg = ratings.reduce((a, b) => a + b, 0) / ratings.length;

        if (speed <= 2) text.push("<span style=\"color: red; font-weight: bold;\">Pelanggan merasa kecepatan internet sangat lambat dan sering mengganggu aktivitas online.</span>");
        else if (speed === 3) text.push("Kecepatan internet dirasa cukup baik, namun kadang melambat di jam tertentu.");
        else text.push("Kecepatan internet dinilai cepat dan memuaskan pelanggan.");

        if (stability <= 2) text.push("<span style=\"color: red; font-weight: bold;\">Koneksi sering tidak stabil atau terputus.</span>");
        else if (stability === 3) text.push("Koneksi cukup stabil, meskipun kadang mengalami gangguan kecil.");
        else text.push("Koneksi internet sangat stabil tanpa gangguan berarti.");

        if (support <= 2) text.push("<span style=\"color: red; font-weight: bold;\">Layanan pelanggan dinilai lambat dan kurang membantu dalam menyelesaikan masalah.</span>");
        else if (support === 3) text.push("Layanan pelanggan cukup responsif, meski masih bisa ditingkatkan.");
        else text.push("Layanan pelanggan cepat, ramah, dan sangat membantu.");

        if (price <= 2) text.push("<span style=\"color: red; font-weight: bold;\">Harga dianggap tidak sebanding dengan kualitas layanan yang diterima.</span>");
        else if (price === 3) text.push("Harga dirasa cukup sebanding dengan kualitas yang diberikan.");
        else text.push("Harga dinilai sangat sepadan bahkan di bawah ekspektasi pelanggan.");

        if (overall <= 2) text.push("<span style=\"color: red; font-weight: bold;\">Secara keseluruhan pelanggan merasa tidak puas dan membutuhkan peningkatan signifikan.</span>");
        else if (overall === 3) text.push("Secara umum pelanggan cukup puas namun berharap peningkatan di beberapa aspek.");
        else text.push("Pelanggan merasa sangat puas dan kemungkinan besar akan merekomendasikan layanan ini.");

        let tone = "";
        if (avg <= 2.5) tone = "<span style=\"color: red; font-weight: bold;\">Kesimpulan: Tingkat kepuasan pelanggan sangat rendah. Disarankan dilakukan tindak lanjut segera oleh tim teknis dan customer care.</span>";
        else if (avg < 4) tone = "Kesimpulan: Pelanggan cukup puas, namun ada beberapa aspek yang perlu perbaikan agar pengalaman lebih konsisten.";
        else tone = "Kesimpulan: Pelanggan sangat puas dengan layanan internet secara keseluruhan.";

        return text.join(" ") + " " + tone;
      }

      // --- From components/icons.tsx ---
      const StarIcon = (props) => (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" {...props}>
          <path fillRule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.007z" clipRule="evenodd" />
        </svg>
      );
      const TrashIcon = (props) => (
          <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" {...props}>
              <path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clipRule="evenodd" />
          </svg>
      );
      const CameraIcon = (props) => (
          <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" {...props}>
              <path fillRule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z" clipRule="evenodd" />
          </svg>
      );
      const UploadIcon = (props) => (
          <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" {...props}>
              <path d="M5.5 13a3.5 3.5 0 01-.369-6.98 4 4 0 117.753-1.977A4.5 4.5 0 1113.5 13H11V9.414l-1.293 1.293a1 1 0 01-1.414-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 9.414V13H5.5z" />
              <path d="M9 13h2v5a1 1 0 11-2 0v-5z" />
          </svg>
      );
      const PlusIcon = (props) => (
        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" {...props}>
            <path fillRule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clipRule="evenodd" />
        </svg>
      );

      // --- From components/StarRating.tsx ---
      const StarRating = ({ rating, onRatingChange }) => {
        const [hoverRating, setHoverRating] = React.useState(0);
        return (
          <div className="flex items-center space-x-1">
            {[1, 2, 3, 4, 5].map((star) => (
              <button key={star} type="button" onClick={() => onRatingChange(star)} onMouseEnter={() => setHoverRating(star)} onMouseLeave={() => setHoverRating(0)} className="focus:outline-none transition-transform duration-200 hover:scale-110">
                <StarIcon className={`w-6 h-6 transition-colors duration-200 ${(hoverRating || rating) >= star ? 'text-yellow-400' : 'text-gray-300'}`} />
              </button>
            ))}
          </div>
        );
      };

      // --- From components/SearchableDropdown.tsx ---
      const SearchableDropdown = ({ options, value, onChange, placeholder }) => {
        const [isOpen, setIsOpen] = React.useState(false);
        const [searchTerm, setSearchTerm] = React.useState('');
        const dropdownRef = React.useRef(null);

        const filteredOptions = options.filter(option => option.toLowerCase().includes(searchTerm.toLowerCase()));

        const handleSelect = (option) => {
          onChange(option);
          setSearchTerm('');
          setIsOpen(false);
        };

        React.useEffect(() => {
          const handleClickOutside = (event) => {
            if (dropdownRef.current && !dropdownRef.current.contains(event.target)) setIsOpen(false);
          };
          document.addEventListener('mousedown', handleClickOutside);
          return () => document.removeEventListener('mousedown', handleClickOutside);
        }, []);

        return (
          <div className="relative" ref={dropdownRef}>
            <input type="text" value={isOpen ? searchTerm : value} onFocus={() => setIsOpen(true)} onChange={e => { if(!isOpen) setIsOpen(true); setSearchTerm(e.target.value); }} placeholder={placeholder || "Search or select..."} className="w-full bg-white text-gray-900 border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:shadow-md" />
            {isOpen && (
              <div className="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto">
                <ul>
                  {filteredOptions.length > 0 ? (
                    filteredOptions.map(option => (
                      <li key={option} onClick={() => handleSelect(option)} className="px-4 py-2 text-gray-700 cursor-pointer hover:bg-blue-50 hover:text-blue-600">
                        {option}
                      </li>
                    ))
                  ) : ( <li className="px-4 py-2 text-gray-500">No results found</li> )}
                </ul>
              </div>
            )}
          </div>
        );
      };
      
      // --- From components/AspectInput.tsx ---
      const AspectInput = ({ aspect, onChange }) => {
        const handleStatusChange = (newStatus) => onChange({ ...aspect, status: newStatus, description: newStatus === AspectStatus.NO_NEED ? '' : aspect.description });
        const handleDescriptionChange = (e) => onChange({ ...aspect, description: e.target.value });
        const isNoNeed = aspect.status === AspectStatus.NO_NEED;
        return (
          <section className="p-6 bg-white border border-gray-200 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300">
            <h2 className="text-xl font-bold text-gray-800 mb-4">{aspect.title}</h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
              <div className="flex space-x-6">
                <label className="flex items-center space-x-2 text-gray-700 cursor-pointer hover:text-yellow-600 transition-colors">
                  <input type="radio" name={`aspect-${aspect.id}`} checked={aspect.status === AspectStatus.NEED_IMPROVEMENT} onChange={() => handleStatusChange(AspectStatus.NEED_IMPROVEMENT)} className="form-radio h-5 w-5 text-yellow-500 bg-white border-gray-300 focus:ring-yellow-500" />
                  <span>Need Improvement</span>
                </label>
                <label className="flex items-center space-x-2 text-gray-700 cursor-pointer hover:text-green-600 transition-colors">
                  <input type="radio" name={`aspect-${aspect.id}`} checked={isNoNeed} onChange={() => handleStatusChange(AspectStatus.NO_NEED)} className="form-radio h-5 w-5 text-green-500 bg-white border-gray-300 focus:ring-green-500" />
                  <span>No Need</span>
                </label>
              </div>
              <div>
                <textarea value={aspect.description} onChange={handleDescriptionChange} maxLength={200} placeholder={aspect.id === 'branchCondition' ? 'wallpaper store harus diperbaiki, ac tidak dingin dll' : aspect.id === 'sop' ? 'team branch telat, tidak pakai seragam dll' : aspect.id === 'salesKnowledge' ? 'team tidak tahu tentang biznet dll' : aspect.id === 'atl' ? 'banner tiang tidak ada, spanduk copot di jl xxx. dst' : 'Description (optional)'} disabled={isNoNeed} className="w-full h-24 bg-white text-gray-900 border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:shadow-md disabled:opacity-50 disabled:bg-gray-100 text-sm placeholder:text-gray-400" />
              </div>
            </div>
          </section>
        );
      };

      // --- From components/CustomerExperienceCard.tsx ---
      const CustomerExperienceCard = ({ experience, onChange, onDelete, isDeletable }) => {
        const handleRatingChange = (category, value) => onChange({ ...experience, ratings: { ...experience.ratings, [category]: value }});
        const handleInputChange = (e) => onChange({ ...experience, [e.target.name]: e.target.value });
        const handleImagesChange = (newImages) => onChange({ ...experience, images: newImages });
        const RatingRow = ({ label, rating, onRate }) => (
            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center">
                <span className="text-gray-700 mb-1 sm:mb-0 font-medium">{label}</span>
                <StarRating rating={rating} onRatingChange={onRate} />
            </div>
        );
        return (
          <div className="p-6 bg-white border border-gray-200 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 relative">
            {isDeletable && ( <button onClick={() => onDelete(experience.id)} className="absolute top-4 right-4 text-red-500 hover:text-red-600 transition-colors hover:scale-110 transform"> <TrashIcon className="w-5 h-5" /> </button> )}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
              <input type="text" name="billingAccount" placeholder="Billing Account" value={experience.billingAccount} onChange={handleInputChange} className="w-full bg-white text-gray-900 border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:shadow-md" />
              <input type="text" name="name" placeholder="Customer Name" value={experience.name} onChange={handleInputChange} className="w-full bg-white text-gray-900 border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:shadow-md" />
            </div>
            <div className="space-y-4">
              <RatingRow label="Kecepatan Internet" rating={experience.ratings.speed} onRate={val => handleRatingChange('speed', val)} />
              <RatingRow label="Kestabilan Koneksi" rating={experience.ratings.stability} onRate={val => handleRatingChange('stability', val)} />
              <RatingRow label="Layanan Pelanggan" rating={experience.ratings.support} onRate={val => handleRatingChange('support', val)} />
              <RatingRow label="Harga dan Kesesuaian" rating={experience.ratings.price} onRate={val => handleRatingChange('price', val)} />
              <RatingRow label="Kepuasan Keseluruhan" rating={experience.ratings.overall} onRate={val => handleRatingChange('overall', val)} />
            </div>
            <div className="mt-6">
              <h4 className="font-semibold text-gray-800 mb-2">Summary:</h4>
              <p className="text-sm text-gray-600 bg-gray-50 p-4 rounded-lg min-h-[6rem] border border-gray-200" dangerouslySetInnerHTML={{ __html: experience.summary }}></p>
            </div>
            <div className="mt-6">
              <div className="p-4 bg-white border border-gray-200 rounded-xl shadow-sm">
                <ImageUpload images={experience.images} onImagesChange={handleImagesChange} />
              </div>
            </div>
          </div>
        );
      };

      // --- From components/ImageUpload.tsx ---
      const ImageUpload = ({ images, onImagesChange }) => {
        const [showOptions, setShowOptions] = React.useState(false);
        const fileInputRef = React.useRef(null);
        const videoRef = React.useRef(null);
        const canvasRef = React.useRef(null);
        const [isCameraOn, setIsCameraOn] = React.useState(false);
        const [facingMode, setFacingMode] = React.useState('user'); // 'user' for front, 'environment' for back

        const addImage = (src) => onImagesChange([...images, { id: `img-${Date.now()}`, src }]);
        const removeImage = (id) => onImagesChange(images.filter(img => img.id !== id));

        const handleFileChange = (event) => {
          if (event.target.files && event.target.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => e.target?.result && addImage(e.target.result);
            reader.readAsDataURL(event.target.files[0]);
          }
          setShowOptions(false);
        };
        const openCamera = async () => {
          setShowOptions(false);
          try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: facingMode } });
            if (videoRef.current) { videoRef.current.srcObject = stream; setIsCameraOn(true); }
          } catch (err) { console.error("Error accessing camera:", err); alert("Could not access camera. Please ensure permissions are granted."); }
        };
        const takePicture = async () => {
          if (videoRef.current && canvasRef.current) {
            const context = canvasRef.current.getContext('2d');
            if (context) {
              canvasRef.current.width = videoRef.current.videoWidth;
              canvasRef.current.height = videoRef.current.videoHeight;
              context.drawImage(videoRef.current, 0, 0, videoRef.current.videoWidth, videoRef.current.videoHeight);

              // Add geolocation and timestamp overlay
              try {
                const position = await new Promise((resolve, reject) => {
                  navigator.geolocation.getCurrentPosition(resolve, reject, { enableHighAccuracy: true, timeout: 5000 });
                });
                const { latitude, longitude } = position.coords;
                const timestamp = new Date().toLocaleString();

                context.fillStyle = 'rgba(0, 0, 0, 0.7)';
                context.fillRect(10, canvasRef.current.height - 60, canvasRef.current.width - 20, 50);
                context.fillStyle = 'white';
                context.font = '12px Arial';
                context.fillText(`Date: ${timestamp}`, 20, canvasRef.current.height - 40);
                context.fillText(`Location: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`, 20, canvasRef.current.height - 20);
              } catch (error) {
                console.warn('Could not get geolocation:', error);
                // Add timestamp only if geolocation fails
                const timestamp = new Date().toLocaleString();
                context.fillStyle = 'rgba(0, 0, 0, 0.7)';
                context.fillRect(10, canvasRef.current.height - 40, canvasRef.current.width - 20, 30);
                context.fillStyle = 'white';
                context.font = '12px Arial';
                context.fillText(`Date: ${timestamp}`, 20, canvasRef.current.height - 20);
              }

              addImage(canvasRef.current.toDataURL('image/png'));
              // Do not close camera automatically, allow multiple pictures
            }
          }
        };
        const closeCamera = () => {
          if (videoRef.current && videoRef.current.srcObject) {
            videoRef.current.srcObject.getTracks().forEach(track => track.stop());
          }
          setIsCameraOn(false);
        };
        const flipCamera = async () => {
          const newFacingMode = facingMode === 'user' ? 'environment' : 'user';
          setFacingMode(newFacingMode);
          closeCamera();
          setTimeout(() => openCamera(), 100); // Reopen camera with new facing mode
        };

        return (
          <section className="p-6 bg-white border border-gray-200 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300">
            <h2 className="text-2xl font-bold text-gray-800 mb-6">Image Visitation</h2>
            {isCameraOn && (
              <div className="mb-6">
                <video ref={videoRef} autoPlay playsInline muted className="w-full rounded-xl mb-4 shadow-lg" />
                <div className="flex justify-center space-x-4">
                  <button onClick={takePicture} className="px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-lg shadow-md transition-all duration-300 hover:scale-105 transform">üì∏ Take Picture</button>
                  <button onClick={flipCamera} className="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg shadow-md transition-all duration-300 hover:scale-105 transform">üîÑ Flip Camera</button>
                  <button onClick={closeCamera} className="px-6 py-3 bg-red-500 hover:bg-red-600 text-white font-semibold rounded-lg shadow-md transition-all duration-300 hover:scale-105 transform">‚ùå Close Camera</button>
                </div>
                <canvas ref={canvasRef} className="hidden" />
              </div>
            )}
            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-6">
              {images.map(image => (
                <div key={image.id} className="relative group">
                  <img src={image.src} alt="Visitation" className="w-full h-32 object-cover rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300"/>
                  <button onClick={() => removeImage(image.id)} className="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-all duration-300 hover:scale-110 transform"> <TrashIcon className="w-4 h-4" /> </button>
                </div>
              ))}
            </div>
            <div className="text-center relative">
              <button onClick={() => setShowOptions(!showOptions)} className="px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-lg transition-all duration-300 hover:scale-105 transform"> Upload Image </button>
              {showOptions && (
                <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-56 bg-white rounded-lg shadow-xl border border-gray-200 p-2 flex flex-col space-y-2 z-20">
                  <button onClick={() => fileInputRef.current?.click()} className="flex items-center justify-center w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-blue-50 rounded-md transition-colors"> <UploadIcon className="w-4 h-4 mr-2" /> <span>From Album</span> </button>
                  <button onClick={openCamera} className="flex items-center justify-center w-full px-4 py-3 text-left text-sm text-gray-700 hover:bg-blue-50 rounded-md transition-colors"> <CameraIcon className="w-4 h-4 mr-2" /> <span>Use Camera</span> </button>
                </div>
              )}
              <input type="file" ref={fileInputRef} onChange={handleFileChange} accept="image/*" className="hidden"/>
            </div>
            {isCameraOn && (
              <div className="mt-4 p-4 bg-gray-50 rounded-lg">
                <p className="text-sm text-gray-600 text-center">Camera is active. Use the controls above to take pictures.</p>
              </div>
            )}
          </section>
        );
      };
      
      // --- PDF Report Template Component ---
      const PdfReportTemplate = ({ date, visitor, branch, aspects, experiences }) => {
        const renderStars = (rating) => '‚òÖ'.repeat(rating) + '‚òÜ'.repeat(5 - rating);
        return (
            <div style={{ width: '800px', backgroundColor: 'white', color: 'black', padding: '40px', fontFamily: 'Arial, sans-serif', border: '1px solid #333' }}>
                <div style={{ marginBottom: '20px', lineHeight: '1.5' }}>
                    <p><strong>Date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</strong> {new Date(date + 'T00:00:00').toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' })}</p>
                    <p><strong>Visitor&nbsp;&nbsp;&nbsp;:</strong> {visitor}</p>
                    <p><strong>Branch&nbsp;&nbsp;&nbsp;:</strong> {branch}</p>
                </div>

                <table style={{ width: '100%', borderCollapse: 'collapse', border: '1px solid black', marginBottom: '20px' }}>
                    <thead>
                        <tr>
                            <th style={{ border: '1px solid black', padding: '4px', textAlign: 'center', fontWeight: 'bold' }}>Aspect</th>
                            <th style={{ border: '1px solid black', padding: '4px', textAlign: 'center', fontWeight: 'bold' }}>Need Improvment</th>
                            <th style={{ border: '1px solid black', padding: '4px', textAlign: 'center', fontWeight: 'bold' }}>No Need</th>
                            <th style={{ border: '1px solid black', padding: '4px', textAlign: 'center', fontWeight: 'bold' }}>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        {aspects.map(aspect => (
                            <tr key={aspect.id}>
                                <td style={{ border: '1px solid black', padding: '4px' }}>{aspect.title}</td>
                                <td style={{ border: '1px solid black', padding: '4px', textAlign: 'center', fontSize: '1.2em', color: '#008000' }}>{aspect.status === AspectStatus.NEED_IMPROVEMENT ? '‚úì' : ''}</td>
                                <td style={{ border: '1px solid black', padding: '4px', textAlign: 'center', fontSize: '1.2em', color: '#008000' }}>{aspect.status === AspectStatus.NO_NEED ? '‚úì' : ''}</td>
                                <td style={{ border: '1px solid black', padding: '4px' }}>{aspect.status === AspectStatus.NEED_IMPROVEMENT ? aspect.description : 'null'}</td>
                            </tr>
                        ))}
                    </tbody>
                </table>

                {experiences.map((exp) => (
                    <table key={exp.id} style={{ width: '100%', borderCollapse: 'collapse', border: '1px solid black', marginBottom: '20px' }}>
                        <thead>
                            <tr>
                                <th colSpan="3" style={{ border: '1px solid black', padding: '4px', textAlign: 'left', fontWeight: 'bold' }}>Customer Experience</th>
                            </tr>
                            <tr>
                                <th style={{ borderBottom: '1px solid black', padding: '4px', width: '35%' }}></th>
                                <th style={{ borderBottom: '1px solid black', padding: '4px', textAlign: 'center', width: '30%', fontWeight: 'bold' }}></th>
                                <th style={{ borderBottom: '1px solid black', padding: '4px', textAlign: 'center', fontWeight: 'bold' }}></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colSpan="3" style={{ border: '1px solid black', padding: '4px', fontWeight: 'bold' }}>Billing Account: {exp.billingAccount}</td>
                            </tr>
                            <tr>
                                <td colSpan="3" style={{ border: '1px solid black', padding: '4px', fontWeight: 'bold' }}>Customer Name: {exp.name}</td>
                            </tr>
                            {exp.images.map((image, imgIndex) => (
                                <tr key={imgIndex}>
                                    <td colSpan="3" style={{ border: '1px solid black', padding: '4px' }}>
                                        <img src={image.src} alt={`Visitation ${imgIndex + 1}`} style={{ width: '100px', height: 'auto', border: '1px solid #CCC' }}/>
                                    </td>
                                </tr>
                            ))}
                            <tr>
                                <td style={{ border: '1px solid black', padding: '4px' }}>Kecepatan Internet</td>
                                <td style={{ border: '1px solid black', padding: '4px', fontSize: '1.5em', color: '#FFC107', textAlign: 'center' }}>{renderStars(exp.ratings.speed)}</td>
                                <td style={{ border: '1px solid black', padding: '4px', verticalAlign: 'top', textAlign: 'left' }} rowSpan="5">{exp.summary}</td>
                            </tr>
                            <tr><td style={{ border: '1px solid black', padding: '4px' }}>Kestabilan Koneksi</td><td style={{ border: '1px solid black', padding: '4px', fontSize: '1.5em', color: '#FFC107', textAlign: 'center' }}>{renderStars(exp.ratings.stability)}</td></tr>
                            <tr><td style={{ border: '1px solid black', padding: '4px' }}>Layanan Pelanggan</td><td style={{ border: '1px solid black', padding: '4px', fontSize: '1.5em', color: '#FFC107', textAlign: 'center' }}>{renderStars(exp.ratings.support)}</td></tr>
                            <tr><td style={{ border: '1px solid black', padding: '4px' }}>Harga dan Kesesuaian Layanan</td><td style={{ border: '1px solid black', padding: '4px', fontSize: '1.5em', color: '#FFC107', textAlign: 'center' }}>{renderStars(exp.ratings.price)}</td></tr>
                            <tr><td style={{ border: '1px solid black', padding: '4px' }}>Kepuasan Keseluruhan</td><td style={{ border: '1px solid black', padding: '4px', fontSize: '1.5em', color: '#FFC107', textAlign: 'center' }}>{renderStars(exp.ratings.overall)}</td></tr>
                        </tbody>
                    </table>
                ))}

                <div style={{ position: 'absolute', bottom: '20px', right: '40px', fontSize: '0.8em', color: '#555' }}>
                    Documment by West Territory 4
                </div>
            </div>
        );
      };

      // --- Main App Component (from App.tsx) ---
      const App = () => {
        const { useState, useRef, useCallback, useEffect } = React;
        const initialAspects = [
          { id: 'branchCondition', title: 'Branch Condition', status: AspectStatus.UNSELECTED, description: '' },
          { id: 'sop', title: 'Standart Operation Procedure', status: AspectStatus.UNSELECTED, description: '' },
          { id: 'salesKnowledge', title: 'Biznet Knowledge', status: AspectStatus.UNSELECTED, description: '' },
          { id: 'atl', title: 'Branding', status: AspectStatus.UNSELECTED, description: '' },
        ];
        const branchOptions = [
  'Branch Metro Hadimulyo Barat',
  'Branch Bandar Lampung Tanjung Senang',
  'Branch Lampung Tengah Bandar Jaya',
  'Branch Lampung Selatan Kalianda',
  'Branch Bandar Lampung Rawa Laut',
  'Branch Bandar Lampung Rajabasa',
  'Branch Mesuji Umbulan Tedunggeram',
  'Branch Bandar Bandar Lampung Campang Raya',
  'Branch Tulang Bawang Barat Banjar Agung',
  'Branch Tulang Bawang Barat Menggala',
  'Branch Jambi Kenali Asam Bawah',
  'Branch Jambi Kenali Besar',
  'Branch Jambi Thehok',
  'Branch Bengkulu Jembatan Kecil',
  'Branch Muaro Jambi Sengeti',
  'Branch Tanjung Jabung Barat Kuala Tungkal',
  'Branch Tanjung Jabung Barat Merlung',
  'Branch Banyuasin Pangkalan Balai',
  'Branch Banyuasin Betung',
  'Branch Banyuasin Sungsang',
  'Branch Bangka Sungai Liat',
  'Branch Bangka Barat Kelapa',
  'Branch Bangka Barat Muntok',
  'Branch Musi Banyausin Bayung Lecir',
  'Branch Musi Banyuasin Pangkalan Gresik',
  'Branch Musi Banyuasin Sungai Lilin',
  'Branch Ogan Komering Ilir Kayu Agung',
  'Branch Ogan Komering Ilir Tugu Mulyo',
  'Branch Palembang 8 Ulu',
  'Branch Palembang Kalidoni',
  'Branch Palembang Karya Jaya',
  'Branch Palembang Sekip Jaya',
  'Branch Palembang Sukamaju',
  'Branch Palembang Sukodadi',
  'Branch Pangkal Pinang Batin Tikal'
];
        const visitorOptions = ['Dedi Riyanto', 'Made Marsha Bayu Kresna', 'Piscesco Heyziputra'];

        const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
        const [visitor, setVisitor] = useState('');
        const [branch, setBranch] = useState('');
        const [aspects, setAspects] = useState(initialAspects);
        const [experiences, setExperiences] = useState([]);
        const [isSubmitting, setIsSubmitting] = useState(false);
        const [activeTab, setActiveTab] = useState('basic');
        const [showSuccessPopup, setShowSuccessPopup] = useState(false);
        const reportRef = useRef(null);

        const isTabComplete = (tabId) => {
          switch (tabId) {
            case 'basic':
              return date && visitor && branch;
            case 'aspects':
              return aspects.every(a => a.status !== AspectStatus.UNSELECTED);
            case 'experience':
              return experiences.every(e => e.billingAccount && e.name && Object.values(e.ratings).every(r => r > 0) && e.images.length > 0);
            default:
              return false;
          }
        };

        const getNextTab = (currentTab) => {
          const tabsOrder = ['basic', 'aspects', 'experience'];
          const currentIndex = tabsOrder.indexOf(currentTab);
          return currentIndex < tabsOrder.length - 1 ? tabsOrder[currentIndex + 1] : null;
        };



        const handleAspectChange = useCallback((updatedAspect) => {
          setAspects(prev => prev.map(a => a.id === updatedAspect.id ? updatedAspect : a));
        }, []);
        const handleExperienceChange = useCallback((updatedExperience) => {
          const ratingsArray = [ updatedExperience.ratings.speed, updatedExperience.ratings.stability, updatedExperience.ratings.support, updatedExperience.ratings.price, updatedExperience.ratings.overall ];
          const summary = generateSummary(ratingsArray);
          setExperiences(prev => prev.map(exp => exp.id === updatedExperience.id ? { ...updatedExperience, summary } : exp));
        }, []);
        const addExperience = () => {
          const newExperience = { id: `exp-${Date.now()}`, billingAccount: '', name: '', ratings: { speed: 0, stability: 0, support: 0, price: 0, overall: 0 }, summary: 'Please provide ratings to generate a summary.', images: [] };
          setExperiences(prev => [...prev, newExperience]);
          // Add click effect
          const button = document.activeElement;
          if (button) {
            button.style.transform = 'scale(0.95)';
            setTimeout(() => button.style.transform = '', 150);
          }
        };
        const deleteExperience = (id) => {
          if (experiences.length > 1) {
              setExperiences(prev => prev.filter(exp => exp.id !== id));
              // Show notification
              const notification = document.createElement('div');
              notification.textContent = 'Visitation deleted';
              notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ef4444;
                color: white;
                padding: 12px 16px;
                border-radius: 8px;
                font-weight: 500;
                z-index: 1000;
                animation: slide-in 0.3s ease-out;
              `;
              document.body.appendChild(notification);
              setTimeout(() => {
                notification.style.animation = 'fade-out 0.3s ease-out';
                setTimeout(() => document.body.removeChild(notification), 300);
              }, 2000);
          } else {
              alert('At least one customer visitation is required.');
          }
        };
        
        useEffect(() => { if(experiences.length === 0) { addExperience(); } }, []);

        const validateForm = () => {
          const errors = [];
          if (!date) errors.push('Date');
          if (!visitor) errors.push('Visitor Name');
          if (!branch) errors.push('Branch Name');
          if (aspects.some(a => a.status === AspectStatus.UNSELECTED)) errors.push('all Aspects');
          if (experiences.some(e => !e.billingAccount || !e.name || Object.values(e.ratings).some(r => r === 0))) errors.push('all Customer Experience fields');
          if (experiences.some(e => e.images.length === 0)) errors.push('at least one Image per Customer Experience');
          return errors;
        };

        const handleSubmit = async () => {
          const errors = validateForm();
          if (errors.length > 0) {
            alert(`Please fill in the following sections: ${errors.join(', ')}`);
            return;
          }

          setIsSubmitting(true);
          await new Promise(resolve => setTimeout(resolve, 100));
          if (reportRef.current) {
            try {
              const canvas = await html2canvas(reportRef.current, { scale: 2, useCORS: true, backgroundColor: '#ffffff' });
              const imgData = canvas.toDataURL('image/png');
              const { jsPDF } = window.jspdf;
              const pdf = new jsPDF({ orientation: 'portrait', unit: 'px', format: [canvas.width, canvas.height] });
              pdf.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
              pdf.save(`Visitation_Report_${branch.replace(/\s/g, '_')}_${date}.pdf`);

              const subject = `Visitation Report: ${branch} - ${date}`;
              const body = `Dear Pak Dedi,\n\nTerlampir report kunjungan ke ${branch} yang dilakukan pada ${date} oleh ${visitor}.\n\nBest regards.`;
              window.location.href = `mailto:dedi_riyanto@biznetnetworks.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;

              setShowSuccessPopup(true);
              setTimeout(() => {
                setShowSuccessPopup(false);
                // Reset form to initial state
                setDate(new Date().toISOString().split('T')[0]);
                setVisitor('');
                setBranch('');
                setAspects(initialAspects);
                setExperiences([]);
                setActiveTab('basic');
                // Add initial experience
                addExperience();
              }, 3000);

            } catch (error) { console.error("Error generating PDF:", error); alert("Failed to generate PDF. Please try again."); }
          }
          setIsSubmitting(false);
        };
        
        const tabs = [
          { id: 'basic', label: 'Visitor Information', icon: 'üìã' },
          { id: 'aspects', label: 'Internal Experience', icon: 'üîç' },
          { id: 'experience', label: 'Customer Experience', icon: '‚≠ê' }
        ];

        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 p-2 sm:p-4 lg:p-6 font-sans">
            <div className="max-w-5xl mx-auto">
              <header className="text-center mb-8 animate-fade-in">
                <h1 className="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 mb-2">
                  WORK WITH WEST 4
                </h1>
                <p className="text-gray-600 text-lg">Every visit brings new insights.</p>
              </header>

              <div className="bg-white rounded-2xl shadow-xl overflow-hidden animate-slide-up">
                <div className="flex border-b border-gray-200">
                  {tabs.map(tab => (
                    <button
                      key={tab.id}
                      onClick={() => setActiveTab(tab.id)}
                      className={`flex-1 py-4 px-2 text-center font-medium transition-all duration-300 ${
                        activeTab === tab.id
                          ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50'
                          : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'
                      }`}
                    >
                      <span className="text-lg mb-1 block">{tab.icon}</span>
                      <span className="text-sm">{tab.label}</span>
                    </button>
                  ))}
                </div>

                <div className="p-6">
                  {activeTab === 'basic' && (
                    <div className="animate-fade-in">
                      <h2 className="text-2xl font-bold text-gray-800 mb-6">Basic Information</h2>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div className="animate-slide-in-left">
                          <label htmlFor="date" className="block text-sm font-medium text-gray-700 mb-2">Date</label>
                          <input type="date" id="date" value={date} onChange={e => setDate(e.target.value)} className="w-full bg-white text-gray-900 border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:shadow-md"/>
                        </div>
                        <div className="animate-slide-in-left" style={{animationDelay: '0.1s'}}>
                          <label htmlFor="visitor" className="block text-sm font-medium text-gray-700 mb-2">Visitor Name</label>
                          <SearchableDropdown options={visitorOptions} value={visitor} onChange={setVisitor} placeholder="Select visitor..."/>
                        </div>
                        <div className="animate-slide-in-left" style={{animationDelay: '0.2s'}}>
                          <label htmlFor="branch" className="block text-sm font-medium text-gray-700 mb-2">Branch Name</label>
                          <SearchableDropdown options={branchOptions} value={branch} onChange={setBranch} placeholder="Select branch..."/>
                        </div>
                      </div>
                    </div>
                  )}

                  {activeTab === 'aspects' && (
                    <div className="animate-fade-in">
                      <h2 className="text-2xl font-bold text-gray-800 mb-6">Branch Aspects</h2>
                      <div className="space-y-6">
                        {aspects.map((aspect, index) => (
                          <div key={aspect.id} className="animate-slide-in-up" style={{animationDelay: `${index * 0.1}s`}}>
                            <AspectInput aspect={aspect} onChange={handleAspectChange} />
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {activeTab === 'experience' && (
                    <div className="animate-fade-in">
                      <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-gray-800">Customer Experience</h2>
                        <button onClick={addExperience} className="flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition-all duration-300 hover:scale-105 transform">
                          Add Visitation
                        </button>
                      </div>
                      <div className="space-y-6">
                        {experiences.map((exp, index) => (
                          <div key={exp.id} className="animate-slide-in-up" style={{animationDelay: `${index * 0.1}s`}}>
                            <CustomerExperienceCard experience={exp} onChange={handleExperienceChange} onDelete={deleteExperience} isDeletable={index > 0} />
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>

                <div className="bg-gray-50 px-6 py-4 border-t border-gray-200">
                  <div className="text-center">
                    <button onClick={handleSubmit} disabled={isSubmitting} className="px-8 py-3 text-lg font-bold text-white bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg shadow-lg hover:shadow-xl hover:scale-105 transform transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:scale-100">
                      {isSubmitting ? 'Generating Report...' : 'Submit Report'}
                    </button>
                  </div>
                </div>
              </div>

              {showSuccessPopup && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 animate-fade-in">
                  <div className="bg-white rounded-2xl p-8 shadow-2xl animate-bounce-in">
                    <div className="text-center">
                      <div className="text-6xl mb-4">üéâ</div>
                      <h3 className="text-2xl font-bold text-gray-800 mb-2">Thank You!</h3>
                      <p className="text-gray-600">Your report has been submitted successfully!</p>
                    </div>
                  </div>
                </div>
              )}

              <div style={{ position: 'absolute', left: '-9999px', top: 0, zIndex: -1 }}>
                <div ref={reportRef}>
                  <PdfReportTemplate date={date} visitor={visitor} branch={branch} aspects={aspects} experiences={experiences} />
                </div>
              </div>
            </div>
          </div>
        );
      };

      // --- Entry point (from index.tsx) ---
      const rootElement = document.getElementById('root');
      const root = ReactDOM.createRoot(rootElement);
      root.render(<App />);

    </script>
</body>
</html>
